\section{Solutions To Investigate}
To compare the prototypes against, a range of existing solutions need to be first investigated and tested to allow a more accurate comparison.

There are many solutions that have been created to transfer files. Listed below are the solutions that will be compared:

\begin{itemize}
	\item FTP
	\item SMB2
	\item rsync
\end{itemize}


\section{How They Work}
\subsection*{FTP}
FTP is the oldest protocol (introduced in 1971) out of the ones that will be investigated. It allows for transferring files to and from a client and server. Since it was originally created to use NCP it uses two TCP sockets for each client to provide full-duplex communication, although TCP/IP is used which allows for full-duplex communication over one socket although the FTP protocol has never altered to provide compatibility. Having two sockets makes it harder for FTP to work over firewalls, and can even cause connection drops if no command packets are sent while a large data transfer is happening. FTP also uses TCP as a means to allow for a stateful connection meaning if the connection dropped; it would require a new connection handshake.

The FTP protocol has three modes for transferring data. The first is a streaming mode, where raw data is sent as a continuous stream; removing the need for any extra processing to be done by FTP. The other mode is where data is sent in blocks, this requires data to be split into separate blocks each having extra information attached such as the block header, byte count and the data field; this requires processing to be done by both TCP and FTP. The last method is where data is compressed and sent using the block mode.

Command messages are exchanged using telnet strings, meaning they require no serialization step as they use standard ASCII characters. This also means commands could be sent directly by user input. When a server responds to a command it sends back a three digit status code as well as a optional text message which makes it human-readable for example on success as server may reply with: "200" or "200 OK".

FTP has several ways data may be sent, the two main data types are the "Type A" and "Type I". The first uses data sent as ASCII characters making it unsuitable for binary data, the second data type uses bytes making it suitable for sending binary data.

\subsection*{SMB2}
SMB2 is the next protocol to be investigated, it has been selected as it is used in local networks by both business and home users.

Like FTP it also utilises TCP for it's communication however, unlike FTP it uses only a single port since it takes advantage of TCP's full-duplex capability.

A SMB2 packet is more complex than FTP, each packet has a header that uses bytes with padding to represent each field. This machine-readable format is structured meaning the packet will always have the same fields and order, making it simpler to process the packet. As well as being easier to process, it can also contain a lot more information with less overhead; since ASCII characters are not being used which would require eight bytes for each character.

This protocol however differs from FTP as it requires more messages to be exchanged before any read/write commands can be issued. A standard SMB2 connection requires three messages to be exchanged before read/write commands. Then a further two messages to end the connection. On a high latency network or when being used on a VPN, this can create a high amount of wait time; thus making unsuitable for real-time file synchronisation.

% INSERT: SMB2 Connection Diagram

SMB2 like the previous version (SMB1) transfers data using blocks, however unlike SMB1 it now has a flexible block size to increase transfer performance. This block level transfer is similar to FTP's block mode. Using blocks will increase latency due to extra negotiation overhead needed for every block sent and received as well as the TCP acknowledgements. SMB2 however does support pipelining allowing for extra requests to be sent before one has been received, this likely reduces the wait time in total.

\subsection*{rsync}
Rsync is the last protocol that has been selected as it is used in both home and business environments. Compared to the other protocols that have been investigated; it's main feature is synchronisation of file data \parencite{rsync-samba}.

The rsync application is made to work over other protocols such as ssh, however has it's own native TCP implementation which will be investigated since it removes any extra complexities for testing.

The rsync protocol starts a connection in a very minimal way only exchanging a initialisation message, which contains the version number of the protocol and what the supported hashing methods are available. This is very different to the other protocols such as SMB2 which has a complex handshake before any actual transfer can begin.

An rsync transfer between two devices (A and B) works by having "B" splitting each file to synchronise into non-overlapping fixed-sized blocks. Then two checksums are created for each block, one using a rolling algorithm and the other using a md4 hash. These checksums are then sent to "A", "A" then searches through the checksums finding matching ones. "A" then sends "B" instructions on how to construct a copy of the file. Each instruction will either be a reference to one of "B's" checksums or raw data if no matching ones are found \parencite{tridgell1996rsync}.

% INSERT: rsync diagram

This protocol would be considered a block-level transfer since rsync is sending file parts in blocks, rather than a constant data stream. Like SMB2; rsync also uses pipelining of requests to reduce the perceived latency on a connection.


\section{Testing}

Testing will be carried out using isolated networks in Docker to remove any outside interference. The Table~\ref{tab:file-types-used-for-testing} shows what types of files will be used for each test.

\begin{table}[h!]
	\caption{File Types Used For Testing}
	\label{tab:file-types-used-for-testing}
	\centering
	\begin{tabular}{ l l l }
		\hline
		\textbf{Type} & \textbf{Total Bytes} & \textbf{File Count} \\
		\hline
		Single        & 2,000,000            & 1                   \\
		\hline
		Text          & 72,754               & 15                  \\
		\hline
		Photos        & 67,241,693           & 15                  \\
		\hline
		1KB Random    & 512,000              & 500                 \\
		\hline
	\end{tabular}
\end{table}

\begin{table}[h!]
	\caption{Existing Protocols Test Results}
	\label{tab:existing-protocols-test-results}
	\centering
	\begin{tabular}{l l l l l}
		\textbf{Single}     &                      &                        &                         &                      \\
		\textbf{}           & \textbf{Total Bytes} & \textbf{Total Packets} & \textbf{Overhead Bytes} & \textbf{Overhead \%} \\
		\hline
		\textbf{FTP}        & 2,015,995            & 188                    & 15,995                  & 0.79\%               \\
		\hline
		\textbf{SMB}        & 2,085,086            & 444                    & 85,086                  & 4.08\%               \\
		\hline
		\textbf{RSYNC}      & 2,014,762            & 212                    & 14,762                  & 0.73\%               \\
		\hline
		                    &                      &                        &                         &                      \\
		\textbf{Text}       &                      &                        &                         &                      \\
		\textbf{}           & \textbf{Total Bytes} & \textbf{Total Packets} & \textbf{Overhead Bytes} & \textbf{Overhead \%} \\
		\hline
		\textbf{FTP}        & 136,196              & 661                    & 63,442                  & 46.58\%              \\
		\hline
		\textbf{SMB}        & 258,901              & 944                    & 186,147                 & 71.90\%              \\
		\hline
		\textbf{RSYNC}      & 77,101               & 42                     & 4,347                   & 5.64\%               \\
		\hline
		                    &                      &                        &                         &                      \\
		\textbf{Photos}     &                      &                        &                         &                      \\
		\textbf{}           & \textbf{Total Bytes} & \textbf{Total Packets} & \textbf{Overhead Bytes} & \textbf{Overhead \%} \\
		\hline
		\textbf{FTP}        & 67,481,283           & 3,332                  & 239,590                 & 0.36\%               \\
		\hline
		\textbf{SMB}        & 67,579,552           & 2,966                  & 337,859                 & 0.50\%               \\
		\hline
		\textbf{RSYNC}      & 67,471,457           & 3,212                  & 229,764                 & 0.34\%               \\
		\hline
		                    &                      &                        &                         &                      \\
		\textbf{1KB Random} &                      &                        &                         &                      \\
		\textbf{}           & \textbf{Total Bytes} & \textbf{Total Packets} & \textbf{Overhead Bytes} & \textbf{Overhead \%} \\
		\hline
		\textbf{FTP}        & 15,275,292           & 23,150                 & 14,763,292              & 96.65\%              \\
		\hline
		\textbf{SMB}        & 3,009,107            & 11,407                 & 2,497,107               & 82.98\%              \\
		\hline
		\textbf{RSYNC}      & 571,065              & 69                     & 59,065                  & 10.34\%              \\
		\hline
	\end{tabular}
\end{table}

\section{Comparison}
